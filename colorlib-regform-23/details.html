<!DOCTYPE html>
<html dir="rtl">
<style>
/* סגנון ההתראה */
.toast {
    position: fixed;
    top: 0;  /* הצגת ההודעה בחלק העליון */
    left: 50%;
    transform: translateX(-50%);
    background-color: green;
    color: white;
    padding: 15px 20px;
    border-radius: 5px;
    font-size: 16px;
    display: none;
    z-index: 1000;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
.toast.error {
    background-color: red;
}

/* נטרול גלילה בדף */
.no-scroll {
    overflow: hidden;
}

/* עיצוב כפתור שננעל */
button[disabled] {
    background-color: gray;
    cursor: not-allowed;
}
</style>

<head>
    <meta charset="utf-8">
    <title>RegistrationForm_v7 by Colorlib</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- MATERIAL DESIGN ICONIC FONT -->
    <link rel="stylesheet" href="fonts/material-design-iconic-font/css/material-design-iconic-font.min.css">
    
    <!-- STYLE CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="toast" class="toast"></div>  <!-- התראה שנמצאת בחלק העליון של הדף -->

    <div class="wrapper">
        <div class="inner">
            <form id="contactForm">
                <h3>צור קשר</h3>
                <p>השאר כאן את פרטיך, ואשמח לעזור לך ולהפיק לך את האירוע הבא</p>
                <label class="form-group">
                    <input type="text" class="form-control" name="name" required>
                    <span>שמך*</span>
                    <span class="border"></span>
                </label>
                <label class="form-group">
                    <input type="text" class="form-control" name="phone" required>
                    <span>טלפון*</span>
                    <span class="border"></span>
                </label>
                <label class="form-group">
                    <textarea name="message" class="form-control" required></textarea>
                    <span>תוכן הפנייה*</span>
                    <span class="border"></span>
                </label>
                <button type="submit">שלח 
                    <i class="zmdi zmdi-arrow-left" style="margin-right: 10px;"></i>
                </button>
            </form>
        </div>
    </div>
    
</body>

<script>
document.getElementById("contactForm").addEventListener("submit", async function(event) {
    event.preventDefault();  // מונע טעינה מחדש של הדף

    // מניעת גלילה בזמן שליחה
    document.body.classList.add("no-scroll");

    // ננעל את הכפתור בזמן שליחה
    const submitButton = event.target.querySelector("button");
    submitButton.disabled = true;
    submitButton.textContent = "שולח..";

    const formData = new FormData(this);
    const data = {
        name: formData.get("name"),
        phone: formData.get("phone"),
        message: formData.get("message")
    };

    try {
        const response = await fetch("https://ikj2wadvg4a3psfd3qxcn42a7y0iaupn.lambda-url.eu-north-1.on.aws/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        });

        if (!response.ok) {
            throw new Error(`API Error: ${response.statusText}`);
        }

        const result = await response.json();
        console.log(result); // הדפסת התוצאה

        showToast("✅ ההודעה נשלחה בהצלחה!", "success");

        // ניקוי השדות בטופס
        document.getElementById("contactForm").reset();
    } catch (error) {
        console.error("Error:", error);
        showToast(`❌ שגיאה בשליחת ההודעה. אנא פנה בוואטסאפ.`, "error");
    } finally {
        // החזרת אפשרות לגלול לאחר סיום שליחה
        document.body.classList.remove("no-scroll");

        // החזרת הכפתור למצבו הרגיל
        submitButton.disabled = false;
        submitButton.textContent = "שלח";  // מחזירים את הטקסט של הכפתור
    }
});

/* פונקציה להצגת הודעה */
function showToast(message, type) {
    const toast = document.getElementById("toast");
    toast.textContent = message;
    toast.classList.add(type === "error" ? "error" : "success");
    toast.style.display = "block";

    setTimeout(() => {
        toast.style.display = "none";
        toast.classList.remove("error", "success");
    }, 5000); // נעלם אחרי 5 שניות
}
</script>
</html>
